<section>
    <header>
        <h1 style="font-size: 2rem">마이페이지</h1>
        <span>
            <a href="/">홈으로</a>
        </span>
    </header>
</section>
<section>
    <header style="padding: 0">
        <h1>대출/반납 관리</h1>
        <table>
            <thead>
                <tr>
                    <th>이름</th>
                    <th>반납</th>
                </tr>
            </thead>
            <tbody>
                {{ $length := len .BorrowBooks }} {{ if eq $length 0 }}
                <tr>
                    <td>대출한 책이 없습니다</td>
                </tr>
                {{ else }} {{ range .BorrowBooks }}
                <tr>
                    <td>{{ .Title }}</td>
                    <td>
                        <button
                            onclick="returnBook('{{ .ID }}')"
                            style="padding: 5px 10px"
                        >
                            반납
                        </button>
                    </td>
                </tr>
                {{ end }} {{ end }}
            </tbody>
        </table>
    </header>
</section>
<section>
    <header style="padding: 0">
        <h1>대출/반납 기록</h1>
    </header>
    <table>
        <thead>
            <tr>
                <th>이름</th>
                <th>날짜</th>
                <th>대출/반납</th>
            </tr>
        </thead>
        <tbody>
            {{ $length := len .BookLog }} {{ if eq $length 0 }}
            <tr>
                <td>대출한 책이 없습니다</td>
            </tr>
            {{ else }} {{ range .BookLog }}
            <tr>
                <td>{{ .Title }}</td>
                <td>{{ .Date }}</td>
                <td>{{ .Action }}</td>
                {{ end }}
            </tr>
            {{ end }}
        </tbody>
    </table>
</section>
<script>
    async function returnBook(bookId) {
        const resp = await fetch("/api/book/return", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            redirect: "manual",
            body: JSON.stringify({ bookId: Number(bookId) }),
        });
        const status = resp.status;
        if (status === 201) {
            alert("도서 반납 완료되었습니다");
            document.location.href = "/mypage";
        } else {
            alert("도서 반납에 실패했습니다");
        }
    }
</script>
